<div class="user-detail" *ngIf="user">
  <!-- Header -->
  <div class="user-detail__header">
    <button type="button" (click)="onBack()" class="user-detail__back-btn">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Back to Users
    </button>
    <div class="user-detail__header-content">
      <div class="user-detail__title-section">
        <div class="user-detail__avatar-section">
          <div class="user-detail__avatar user-detail__avatar--placeholder">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
        </div>
        <div class="user-detail__title-info">
          <h1 class="user-detail__title">{{ user.userName }}</h1>
          <div class="user-detail__meta">
            <span class="user-detail__meta-item">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2m-7 4H9a2 2 0 01-2-2v-9a2 2 0 012-2h4m7 0v9a2 2 0 01-2 2h-2m-5-4v.01M12 12v.01" />
              </svg>
              ID: {{ user.id }}
            </span>
            <span *ngIf="user.email" class="user-detail__meta-item">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
              {{ user.email }}
              <span *ngIf="user.emailConfirmed" class="user-detail__verified" title="Email Verified">✓</span>
            </span>
            <span *ngIf="user.phoneNumber" class="user-detail__meta-item">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
              {{ user.phoneNumber }}
              <span *ngIf="user.phoneNumberConfirmed" class="user-detail__verified" title="Phone Verified">✓</span>
            </span>
            <span class="user-detail__meta-item">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              Joined {{ user.createdDate | date : "MMM d, y" }}
            </span>
          </div>
        </div>
      </div>
      <div class="user-detail__actions">
        <span [class]="'user-detail__status ' + (getLockoutStatus() === 'Active' ? 'user-detail__status--active' : 'user-detail__status--inactive')">
          {{ getLockoutStatus() }}
        </span>
        <button
          *ngIf="!isEditing"
          type="button"
          (click)="onEdit()"
          class="user-detail__action-btn user-detail__action-btn--edit"
        >
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          Edit
        </button>
        <button
          *ngIf="isEditing"
          type="button"
          (click)="onCancel()"
          class="user-detail__action-btn user-detail__action-btn--cancel"
        >
          Cancel
        </button>
        <button
          *ngIf="isEditing"
          type="button"
          (click)="onSave()"
          [disabled]="userForm.invalid || actionLoading === 'save'"
          class="user-detail__action-btn user-detail__action-btn--save"
        >
          <span *ngIf="actionLoading !== 'save'">Save Changes</span>
          <span *ngIf="actionLoading === 'save'">Saving...</span>
        </button>
        <button
          *ngIf="user && !user.active"
          type="button"
          (click)="onActivate()"
          [disabled]="actionLoading === 'activate'"
          class="user-detail__action-btn user-detail__action-btn--activate"
        >
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span *ngIf="actionLoading !== 'activate'">Activate</span>
          <span *ngIf="actionLoading === 'activate'">Activating...</span>
        </button>
        <button
          *ngIf="user && user.active"
          type="button"
          (click)="onDeactivate()"
          [disabled]="actionLoading === 'deactivate'"
          class="user-detail__action-btn user-detail__action-btn--deactivate"
        >
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span *ngIf="actionLoading !== 'deactivate'">Deactivate</span>
          <span *ngIf="actionLoading === 'deactivate'">Deactivating...</span>
        </button>
        <button
          type="button"
          (click)="onDelete()"
          [disabled]="actionLoading === 'delete'"
          class="user-detail__action-btn user-detail__action-btn--delete"
        >
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="user-detail__message user-detail__message--success">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <span>{{ successMessage }}</span>
  </div>

  <div *ngIf="errorMessage" class="user-detail__message user-detail__message--error">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="user-detail__loading">
    <div class="user-detail__spinner"></div>
    <p>Loading user details...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading" class="user-detail__content">
    <!-- User Information Card -->
    <div class="user-detail__card">
      <div class="user-detail__card-header">
        <h2 class="user-detail__card-title">User Information</h2>
      </div>
      <div class="user-detail__card-body">
        <form [formGroup]="userForm" *ngIf="isEditing; else viewMode">
          <div class="user-detail__form-grid">
            <div class="user-detail__form-group">
              <label class="user-detail__form-label">
                <span>Username</span>
                <span class="user-detail__form-required">*</span>
              </label>
              <input
                type="text"
                formControlName="userName"
                class="user-detail__form-input"
                [class.user-detail__form-input--error]="userForm.get('userName')?.invalid && userForm.get('userName')?.touched"
              />
              <div *ngIf="userForm.get('userName')?.invalid && userForm.get('userName')?.touched" class="user-detail__form-error">
                Username is required and must be at least 3 characters
              </div>
            </div>

            <div class="user-detail__form-group">
              <label class="user-detail__form-label">
                <span>Email</span>
                <span class="user-detail__form-required">*</span>
              </label>
              <input
                type="email"
                formControlName="email"
                class="user-detail__form-input"
                [class.user-detail__form-input--error]="userForm.get('email')?.invalid && userForm.get('email')?.touched"
              />
              <div *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.touched" class="user-detail__form-error">
                Please enter a valid email address
              </div>
            </div>

            <div class="user-detail__form-group">
              <label class="user-detail__form-label">
                <span>Phone Number</span>
                <span class="user-detail__form-required">*</span>
              </label>
              <input
                type="text"
                formControlName="phoneNumber"
                class="user-detail__form-input"
                [class.user-detail__form-input--error]="userForm.get('phoneNumber')?.invalid && userForm.get('phoneNumber')?.touched"
              />
              <div *ngIf="userForm.get('phoneNumber')?.invalid && userForm.get('phoneNumber')?.touched" class="user-detail__form-error">
                Phone number is required
              </div>
            </div>

            <div class="user-detail__form-group">
              <label class="user-detail__form-label">Password</label>
              <input
                type="password"
                formControlName="password"
                class="user-detail__form-input"
                placeholder="Leave empty to keep current password"
              />
              <div class="user-detail__form-hint">
                Leave empty to keep the current password. Enter a new password to change it.
              </div>
            </div>

            <div class="user-detail__form-group">
              <label class="user-detail__form-label">
                <span>Role</span>
                <span class="user-detail__form-required">*</span>
              </label>
              <select
                formControlName="role"
                class="user-detail__form-input"
                [class.user-detail__form-input--error]="userForm.get('role')?.invalid && userForm.get('role')?.touched"
                [disabled]="isLoadingRoles"
              >
                <option [value]="null">Select a role</option>
                <option *ngFor="let role of availableRoles" [value]="role.roleName">
                  {{ role.roleName || 'Unnamed Role' }}
                </option>
              </select>
              <div *ngIf="userForm.get('role')?.invalid && userForm.get('role')?.touched" class="user-detail__form-error">
                Role is required
              </div>
            </div>
          </div>
        </form>

        <ng-template #viewMode>
          <div class="user-detail__info-grid">
            <div class="user-detail__info-item">
              <span class="user-detail__info-label">Username:</span>
              <span class="user-detail__info-value">{{ user.userName }}</span>
            </div>
            <div class="user-detail__info-item">
              <span class="user-detail__info-label">Email:</span>
              <span class="user-detail__info-value">
                {{ user.email || 'N/A' }}
                <span *ngIf="user.emailConfirmed" class="user-detail__verified" title="Email Verified">✓</span>
              </span>
            </div>
            <div class="user-detail__info-item">
              <span class="user-detail__info-label">Phone Number:</span>
              <span class="user-detail__info-value">
                {{ user.phoneNumber || 'N/A' }}
                <span *ngIf="user.phoneNumberConfirmed" class="user-detail__verified" title="Phone Verified">✓</span>
              </span>
            </div>
            <div class="user-detail__info-item">
              <span class="user-detail__info-label">Roles:</span>
              <div class="user-detail__info-value">
                <span *ngFor="let role of user.roles" class="user-detail__role-badge">
                  {{ role }}
                </span>
                <span *ngIf="!user.roles || user.roles.length === 0" class="user-detail__role-badge user-detail__role-badge--none">
                  No roles assigned
                </span>
              </div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Account Status Card -->
    <div class="user-detail__card">
      <div class="user-detail__card-header">
        <h2 class="user-detail__card-title">Account Status</h2>
      </div>
      <div class="user-detail__card-body">
        <div class="user-detail__info-grid">
          <div class="user-detail__info-item">
            <span class="user-detail__info-label">Status:</span>
            <span [class]="'user-detail__info-value ' + (getLockoutStatus() === 'Active' ? 'user-detail__status-badge--active' : 'user-detail__status-badge--inactive')">
              {{ getLockoutStatus() }}
            </span>
          </div>
          <div class="user-detail__info-item">
            <span class="user-detail__info-label">Email Confirmed:</span>
            <span class="user-detail__info-value">
              {{ user.emailConfirmed ? 'Yes' : 'No' }}
            </span>
          </div>
          <div class="user-detail__info-item">
            <span class="user-detail__info-label">Phone Confirmed:</span>
            <span class="user-detail__info-value">
              {{ user.phoneNumberConfirmed ? 'Yes' : 'No' }}
            </span>
          </div>
          <div class="user-detail__info-item">
            <span class="user-detail__info-label">Failed Login Attempts:</span>
            <span class="user-detail__info-value">{{ user.accessFailedCount }}</span>
          </div>
          <div *ngIf="user.lockoutEnd && isLockedOut()" class="user-detail__info-item">
            <span class="user-detail__info-label">Lockout End:</span>
            <span class="user-detail__info-value">{{ user.lockoutEnd | date : "MMM d, y h:mm a" }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Audit Information Card -->
    <div class="user-detail__card">
      <div class="user-detail__card-header">
        <h2 class="user-detail__card-title">Audit Information</h2>
      </div>
      <div class="user-detail__card-body">
        <div class="user-detail__info-grid">
          <div class="user-detail__info-item">
            <span class="user-detail__info-label">Created Date:</span>
            <span class="user-detail__info-value">{{ user.createdDate | date : "MMM d, y h:mm a" }}</span>
          </div>
          <div class="user-detail__info-item">
            <span class="user-detail__info-label">Created By:</span>
            <span class="user-detail__info-value">{{ user.createdBy || 'System' }}</span>
          </div>
          <div class="user-detail__info-item">
            <span class="user-detail__info-label">Last Modified:</span>
            <span class="user-detail__info-value">{{ user.lastModifiedDate | date : "MMM d, y h:mm a" }}</span>
          </div>
          <div class="user-detail__info-item">
            <span class="user-detail__info-label">Last Modified By:</span>
            <span class="user-detail__info-value">{{ user.lastModifiedBy || 'N/A' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

