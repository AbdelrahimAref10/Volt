<div class="customer-detail" *ngIf="customer">
  <!-- Header -->
  <div class="customer-detail__header">
    <button type="button" (click)="onBack()" class="customer-detail__back-btn">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Back to Customers
    </button>
    <div class="customer-detail__header-content">
      <div class="customer-detail__title-section">
        <div class="customer-detail__avatar-section">
          <div *ngIf="customer.personalImage" class="customer-detail__avatar">
            <img [src]="customer.personalImage" [alt]="customer.fullName" />
          </div>
          <div *ngIf="!customer.personalImage" class="customer-detail__avatar customer-detail__avatar--placeholder">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
        </div>
        <div class="customer-detail__title-info">
          <h1 class="customer-detail__title">{{ customer.fullName }}</h1>
          <div class="customer-detail__meta">
            <span class="customer-detail__meta-item">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
              {{ customer.mobileNumber }}
            </span>
            <span class="customer-detail__meta-item">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              {{ customer.cityName || 'N/A' }}
            </span>
            <span class="customer-detail__meta-item">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              Joined {{ customer.createdDate | date : "MMM d, y" }}
            </span>
          </div>
        </div>
      </div>
      <div class="customer-detail__status-badge">
        <span [class]="'customer-detail__status ' + getStateClass(customer.state)">
          {{ getStateLabel(customer.state) }}
        </span>
      </div>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="customer-detail__message customer-detail__message--success">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <span>{{ successMessage }}</span>
  </div>

  <div *ngIf="errorMessage" class="customer-detail__message customer-detail__message--error">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Main Content -->
  <div class="customer-detail__content">
    <!-- Left Column - Customer Information -->
    <div class="customer-detail__info-section">
      <!-- Personal Information Card -->
      <div class="customer-detail__card">
        <div class="customer-detail__card-header">
          <h2 class="customer-detail__card-title">Personal Information</h2>
        </div>
        <div class="customer-detail__card-body">
          <div class="customer-detail__info-grid">
            <div class="customer-detail__info-item">
              <label class="customer-detail__info-label">Full Name</label>
              <div class="customer-detail__info-value">{{ customer.fullName }}</div>
            </div>
            <div class="customer-detail__info-item">
              <label class="customer-detail__info-label">Mobile Number</label>
              <div class="customer-detail__info-value">{{ customer.mobileNumber }}</div>
            </div>
            <div class="customer-detail__info-item">
              <label class="customer-detail__info-label">Gender</label>
              <div class="customer-detail__info-value">{{ customer.gender }}</div>
            </div>
            <div class="customer-detail__info-item">
              <label class="customer-detail__info-label">City</label>
              <div class="customer-detail__info-value">{{ customer.cityName || 'N/A' }}</div>
            </div>
            <div class="customer-detail__info-item">
              <label class="customer-detail__info-label">Register As</label>
              <div class="customer-detail__info-value">
                <span class="customer-detail__badge customer-detail__badge--info">
                  {{ customer.registerAs === 0 ? 'Individual' : 'Institution' }}
                </span>
              </div>
            </div>
            <div class="customer-detail__info-item">
              <label class="customer-detail__info-label">Verification Method</label>
              <div class="customer-detail__info-value">
                <span class="customer-detail__badge customer-detail__badge--info">
                  {{ customer.verificationBy === 0 ? 'Phone' : 'Email' }}
                </span>
              </div>
            </div>
            <div class="customer-detail__info-item">
              <label class="customer-detail__info-label">Email</label>
              <div class="customer-detail__info-value">{{ customer.email || 'Not provided' }}</div>
            </div>
            <div class="customer-detail__info-item customer-detail__info-item--full" *ngIf="customer.commercialRegisterImage">
              <label class="customer-detail__info-label">Commercial Register Image</label>
              <div class="customer-detail__info-value">
                <img [src]="customer.commercialRegisterImage" alt="Commercial Register" class="customer-detail__commercial-image" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Account Status Card -->
      <div class="customer-detail__card">
        <div class="customer-detail__card-header">
          <h2 class="customer-detail__card-title">Account Status</h2>
        </div>
        <div class="customer-detail__card-body">
          <div class="customer-detail__status-grid">
            <div class="customer-detail__status-item">
              <label class="customer-detail__info-label">Account Status</label>
              <span [class]="'customer-detail__status-badge-large ' + getStateClass(customer.state)">
                {{ getStateLabel(customer.state) }}
              </span>
            </div>
            <div class="customer-detail__status-item">
              <label class="customer-detail__info-label">Cash Payment Status</label>
              <span [class]="customer.cashBlock ? 'customer-detail__status-badge-large customer-detail__status-badge-large--blocked' : 'customer-detail__status-badge-large customer-detail__status-badge-large--allowed'">
                <svg *ngIf="!customer.cashBlock" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <svg *ngIf="customer.cashBlock" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                </svg>
                {{ customer.cashBlock ? 'Blocked' : 'Allowed' }}
              </span>
            </div>
            <div class="customer-detail__status-item">
              <label class="customer-detail__info-label">Account Created</label>
              <div class="customer-detail__info-value">
                {{ customer.createdDate | date : "fullDate" }} at {{ customer.createdDate | date : "shortTime" }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column - Control Panel -->
    <div class="customer-detail__control-section">
      <div class="customer-detail__card customer-detail__card--control">
        <div class="customer-detail__card-header">
          <h2 class="customer-detail__card-title">Customer Control Panel</h2>
          <p class="customer-detail__card-subtitle">Manage customer account and permissions</p>
        </div>
        <div class="customer-detail__card-body">
          <!-- Account Status Actions -->
          <div class="customer-detail__action-group">
            <h3 class="customer-detail__action-group-title">Account Status</h3>
            <div class="customer-detail__actions">
              <button
                *ngIf="canActivate()"
                type="button"
                (click)="onActivate()"
                [disabled]="isActionLoading('activate')"
                class="customer-detail__action-btn customer-detail__action-btn--activate"
              >
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>{{ isActionLoading('activate') ? 'Activating...' : 'Activate Account' }}</span>
              </button>

              <button
                *ngIf="canDeactivate()"
                type="button"
                (click)="onDeactivate()"
                [disabled]="isActionLoading('deactivate')"
                class="customer-detail__action-btn customer-detail__action-btn--deactivate"
              >
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>{{ isActionLoading('deactivate') ? 'Deactivating...' : 'Deactivate Account' }}</span>
              </button>

              <button
                *ngIf="canBlock()"
                type="button"
                (click)="onBlock()"
                [disabled]="isActionLoading('block')"
                class="customer-detail__action-btn customer-detail__action-btn--block"
              >
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                </svg>
                <span>{{ isActionLoading('block') ? 'Blocking...' : 'Block Account' }}</span>
              </button>

              <button
                *ngIf="canUnblock()"
                type="button"
                (click)="onUnblock()"
                [disabled]="isActionLoading('unblock')"
                class="customer-detail__action-btn customer-detail__action-btn--unblock"
              >
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>{{ isActionLoading('unblock') ? 'Unblocking...' : 'Unblock Account' }}</span>
              </button>
            </div>
          </div>

          <!-- Cash Payment Control -->
          <div class="customer-detail__action-group">
            <h3 class="customer-detail__action-group-title">Cash Payment Control</h3>
            <div class="customer-detail__actions">
              <button
                *ngIf="!customer.cashBlock"
                type="button"
                (click)="onBlockCash()"
                [disabled]="isActionLoading('blockCash')"
                class="customer-detail__action-btn customer-detail__action-btn--cash-block"
              >
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>{{ isActionLoading('blockCash') ? 'Blocking...' : 'Block Cash Payment' }}</span>
              </button>

              <button
                *ngIf="customer.cashBlock"
                type="button"
                (click)="onUnblockCash()"
                [disabled]="isActionLoading('unblockCash')"
                class="customer-detail__action-btn customer-detail__action-btn--cash-unblock"
              >
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>{{ isActionLoading('unblockCash') ? 'Unblocking...' : 'Unblock Cash Payment' }}</span>
              </button>
            </div>
            <p class="customer-detail__action-description">
              Control whether this customer can make cash payments. When blocked, they can only use other payment methods.
            </p>
          </div>

          <!-- Account Information -->
          <div class="customer-detail__quick-info">
            <div class="customer-detail__quick-info-item">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <div>
                <div class="customer-detail__quick-info-label">Account Created</div>
                <div class="customer-detail__quick-info-value">{{ customer.createdDate | date : "fullDate" }}</div>
              </div>
            </div>
            <div class="customer-detail__quick-info-item">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              <div>
                <div class="customer-detail__quick-info-label">Account Security</div>
                <div class="customer-detail__quick-info-value">Verified</div>
              </div>
            </div>
          </div>

          <!-- Warning Messages -->
          <div *ngIf="customer.state === CustomerState.Blocked" class="customer-detail__warning">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <div>
              <div class="customer-detail__warning-title">Account Blocked</div>
              <div class="customer-detail__warning-text">This customer account is currently blocked and cannot access the system.</div>
            </div>
          </div>

          <div *ngIf="customer.cashBlock" class="customer-detail__warning customer-detail__warning--cash">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div>
              <div class="customer-detail__warning-title">Cash Payment Blocked</div>
              <div class="customer-detail__warning-text">This customer cannot make cash payments. They can only use other payment methods.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="isLoading" class="customer-detail customer-detail--loading">
  <div class="customer-detail__spinner"></div>
  <p>Loading customer details...</p>
</div>

<!-- Error State -->
<div *ngIf="!isLoading && !customer && errorMessage" class="customer-detail customer-detail--error">
  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
  <h2>Customer Not Found</h2>
  <p>{{ errorMessage }}</p>
  <button type="button" (click)="onBack()" class="customer-detail__back-btn">Back to Customers</button>
</div>

